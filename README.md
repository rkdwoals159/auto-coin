# Aden.io/Gate.io - 자동 차익거래 시스템

<div align="center">

[English](README_EN.md) | [한국어](README.md)

</div>

> **⚠️ 주의사항: 이 프로그램은 실제 돈으로 거래됩니다!**

## 📋 프로그램 개요

**Aden**은 **Orderly**와 **Gate.io** 거래소 간의 가격 차이를 실시간으로 모니터링하여 자동으로 차익거래를 실행하는 시스템입니다.

### 🎯 주요 기능

- **실시간 가격 모니터링**: 500ms 간격으로 두 거래소의 가격 차이 추적
- **자동 차익거래**: 설정된 임계값 초과 시 자동으로 포지션 진입/종료
- **스마트 필터링**: 거래량과 가격차이율 기준으로 안전한 거래 기회 탐지
- **포지션 관리**: 진입/종료 가격 자동 추적 및 수익률 계산
- **텔레그램 알림**: 실시간 거래 알림 및 수익률 정보 제공
- **병렬 처리**: 두 거래소 동시 주문으로 빠른 실행

### 💰 거래 방식

- **Orderly**: USDC 선물 거래
- **Gate.io**: USDT 선물 거래
- **차익거래**: 한 거래소에서 매수, 다른 거래소에서 매도
- **시장가 주문**: 빠른 체결을 위한 시장가 주문 사용

### 💸 수수료 정보

- **Orderly 시장가 수수료**: 0.009%
- **Gate.io 시장가 수수료**: 0.04% (레퍼럴 이용 시 최대 80% 환급)

### 🎯 차익거래 원리

이 프로그램은 **실시간으로 두 거래소의 코인 시세 차이를 모니터링**하여, **시세 차이가 가장 큰 코인**에 대해 **서로 반대 방향의 포지션을 진입**함으로써 그 차익만큼의 수익을 얻는 시스템입니다.

#### 📊 차익거래의 기본 원리

**차익거래(Arbitrage Trading)**는 동일한 자산이 서로 다른 시장에서 다른 가격으로 거래될 때 발생하는 가격 차이를 이용하여 수익을 내는 거래 방식입니다.

**예시:**

- **Orderly에서 BTC 가격**: $42,000
- **Gate.io에서 BTC 가격**: $41,800
- **가격 차이**: $200 (0.48% 차이)

#### 🔄 거래 실행 과정

**1단계: 실시간 모니터링**

- 1초 간격으로 모든 코인의 시세 차이 추적
- 24시간_거래금액 필터링 (50만 USDT 이상)으로 안정성 확보
- 가격차이율 임계값 (0.5% 이상) 확인

**2단계: 최적 기회 탐지**

- 시세 차이가 가장 큰 코인 자동 선별
- 거래량, 유동성, 가격 안정성 종합 분석
- 리스크 대비 수익률 계산

**3단계: 반대 포지션 진입**

- **Orderly 가격 > Gate.io 가격**: Orderly에서 매수 + Gate.io에서 매도
- **Gate.io 가격 > Orderly 가격**: Gate.io에서 매수 + Orderly에서 매도
- 병렬 주문 처리로 빠른 실행(500ms소요)

**4단계: 차익 실현**

- 시세 차이가 줄어들 때 자동 포지션 종료
- 목표 수익률 달성 시 자동 종료 (기본: 0.4%)
- 실시간 수익률 계산 및 텔레그램 알림
  - <img width="750" height="1190" alt="image" src="https://github.com/user-attachments/assets/d1304b3c-f5aa-4993-823f-f37db6b2daff" />
  - 위 테스트 스크린샷 에서는 낮은 목표수익률(0.05%)로 인해 실제 시장가 체결시 손실결과 나왔음

#### 💰 수익 구조

**수익 = (높은 가격 - 낮은 가격) - (수수료 + 슬리피지)**

**예시 계산:**

- BTC 1개 거래 시
- 가격 차이: $200
- Orderly 수수료: $42,000 × 0.009% = $3.78
- Gate.io 수수료: $41,800 × 0.04% = $16.72
- **순수익**: $200 - $3.78 - $16.72 = **$179.50**

## 📋 버전 정보 및 면책 조항

**버전**: 0.1  
**상태**: 테스트 버전 (실제 거래 실행)

### ⚠️ 중요한 경고사항

1. **이 프로그램은 실제 돈으로 거래됩니다.** 테스트넷이 아닌 실제 거래소에서 거래가 실행됩니다.
2. **거래소 내 테스트 코드가 없습니다.** 모든 거래는 실제 시장에서 실행됩니다.
3. **이 프로그램 사용으로 인한 손실에 대해 개발자는 책임지지 않습니다.**
4. **사용 전 충분한 테스트와 이해가 필요합니다.**
5. **소액으로 시작하여 점진적으로 금액을 늘리는 것을 권장합니다.**
6. **호가창 매물 확인이 필수입니다.** 감당할 수 있는 호가창 매물이 있을 때만 성공적으로 기능할 수 있습니다. 호가창이 감당할 수 없는 포지션 진입은 슬리피지로 인해 손실을 입을 수 있습니다.

---

## 🏦 필요한 거래소 계정

이 프로그램은 다음 두 거래소의 계정이 필요합니다:

### 1. Orderly (aden.io)

- [Orderly 공식 사이트](https://orderly.org/)
- 계정 생성 및 API 키 발급 필요
- USDC 선물 거래 지원

### 2. Gate.io

- [Gate.io 공식 사이트](https://www.gate.io/)
- 계정 생성 및 API 키 발급 필요
- USDT 선물 거래 지원

---

## ⚙️ 환경 설정

### 1. 시스템 요구사항

**Node.js 버전**: 18.0.0 이상 (권장: 20.0.0 이상)

```bash
# Node.js 버전 확인
node --version

# npm 버전 확인
npm --version
```

**지원되는 플랫폼:**

- ✅ macOS (테스트 완료)
- ✅ Linux
- ✅ Windows

### 2. 의존성 설치

```bash
npm install
```

### 3. 환경 변수 설정

프로젝트 루트에 `.env` 파일을 생성하고 다음 내용을 추가하세요:

```env
# Orderly API 설정
ORDERLY_ACCOUNT_ID=your_orderly_account_id
ORDERLY_API_KEY=your_orderly_api_key
ORDERLY_SECRET_KEY=your_orderly_secret_key

# Gate.io API 설정
GATEIO_API_KEY=your_gateio_api_key
GATEIO_SECRET_KEY=your_gateio_secret_key

# 텔레그램 봇 설정 (선택사항)
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
TELEGRAM_CHAT_ID=your_telegram_chat_id
```

### 4. API 키 발급 방법

#### Orderly API 키 발급

1. [Orderly.org](https://orderly.org/) 접속
2. 계정 생성 및 로그인
3. API 관리 페이지에서 새 API 키 생성
4. 계정 ID, API 키, 시크릿 키 복사

#### Gate.io API 키 발급

1. [Gate.io](https://www.gate.io/) 접속
2. 계정 생성 및 로그인
3. API 관리 페이지에서 새 API 키 생성
4. API 키와 시크릿 키 복사

#### 텔레그램 봇 설정 (선택사항)

1. [@BotFather](https://t.me/botfather)에서 봇 생성
2. 봇 토큰 복사
3. 봇과 대화를 시작하여 채팅 ID 확인

---

## 🚀 프로그램 실행

### 개발 모드 (파일 변경 시 자동 재시작)

```bash
npm run dev
```

### 일반 실행

```bash
npm start
```

### 빌드

```bash
npm run build
```

---

## 🔧 프로그램 기능

### 📊 실시간 시장 모니터링

- **500ms 간격**으로 Orderly와 Gate.io 가격 실시간 모니터링
- **가격차이율 계산** 및 최고 차이율 추적
- **24시간 거래량 필터링** (기본: 500,000 USDT 이상)

### 🤖 자동 차익거래 실행

- **임계값 초과 시 자동 거래 실행** (기본: 0.4% 이상)
- **병렬 주문 처리**로 빠른 실행
- **스마트 수량 계산** 및 반올림

### 💰 포지션 관리

- **진입/종료 가격 자동 추적**
- **목표 수익률 달성 시 자동 종료** (기본: 0.4%)
- **실시간 수익률 계산**

### 📈 Orderbook 분석

- **양방향 orderbook 조회**
- **스프레드 및 거래량 분석**
- **차익거래 기회 평가**

### 🔔 텔레그램 알림

- **포지션 진입/종료 실시간 알림**
- **수익률 및 잔고 정보**
- **거래 상세 정보 제공**

---

## ⚙️ 설정 가능한 매개변수

`main.ts`에서 다음 값들을 조정할 수 있습니다:

```typescript
const ORDERBOOK_MAX_LEVEL = 3; // orderbook 최대 레벨
const MIN_24_AMOUNT = 500000; // 24시간 거래금액 조건
const POSITON_PERCENT = 1; // 포지션 비율 (현재 시드의 %)
const PAUSE_THRESHOLD = 0.4; // 가격차이율 임계값 (%)
const TARGET_PROFIT_PERCENT = 0.4; // 목표 수익률 (%)
const DURATION_HOURS = 500; // 모니터링 시간 (시간)
```

### ⚠️ 시장가 주문 주의사항

**현재 이 프로그램은 포지션 진입/종료 시 시장가 주문을 사용합니다.**

- **거래량이 낮은 코인**에서는 원하는 가격차이율과 실제 체결가격이 다를 수 있습니다
- **시장가 주문의 특성상** 슬리피지(가격 미끄러짐)가 발생할 수 있습니다
- **거래량이 많은 코인**을 선택하거나 `MIN_24_AMOUNT` 값을 높여서 거래량 기준을 강화하는 것을 권장합니다

### 🔧 거래량 기준 조정 방법

거래량이 낮은 코인으로 인한 문제를 방지하려면 `main.ts`에서 다음 값을 조정하세요:

```typescript
// 거래량 기준을 높여서 유동성이 좋은 코인만 거래
const MIN_24_AMOUNT = 1000000; // 100만 USDT 이상 (기본값: 50만)
```

### 💡 기본 설정 권장사항

**안전하고 안정적인 거래를 위해 다음 설정을 권장합니다:**

```typescript
const MIN_24_AMOUNT = 500000; // 50만 USDT 이상 (거래량 기준)
const PAUSE_THRESHOLD = 0.5; // 0.5% 이상 (가격차이율 임계값)
```

**권장 이유:**

- **거래량 50만 USDT 이상**: 슬리피지 최소화 및 안정적인 거래
- **가격차이율 0.5% 이상**: 수수료를 고려한 충분한 수익 마진 확보
- **두 조건을 모두 만족**하는 코인만 거래하여 리스크 최소화

### 💰 수수료 최적화 팁

**이 프로그램은 두 거래소 간 시세차익을 기반으로 수익을 내기 때문에, 수수료 최적화가 매우 중요합니다.**

#### Gate.io 레퍼럴 시스템 활용

- **Gate.io 레퍼럴 링크**를 통해 가입하면 **수수료 할인** 혜택을 받을 수 있습니다
- **추천인 코드**를 사용하여 **거래 수수료를 최대 80%까지 절약**할 수 있습니다 - (유명 유튜버 알아서 찾아주세요)

#### 수수료 최적화 효과

- **기본 수수료**: gate.io기준 0.01% (Maker) / 0.04% (Taker) - 포지션 진입/종료 각각 수수료 발생하므로 해당 수수료의 2배로 계산해주세요
- **레퍼럴 할인 후**: 0.002% (Maker) / 0.016% (Taker)
- **차익거래에서 수수료 절약**이 누적 수익률에 큰 영향을 미칩니다

### ⚠️ QA 및 오류 관련 주의사항

**아직 포지션 진입/종료의 정확한 QA가 이루어지지 않았습니다.**

#### 🚨 발생 가능한 오류 상황

- **포지션 진입/종료 시 원하지 않은 오류**가 일어날 수 있습니다
- **시장가 주문의 특성상** 예상과 다른 체결가격이 발생할 수 있습니다

#### 📊 구체적인 오류 예시

```
예상 거래:
- Aden.io: BTC 롱 진입 (예상가: $42,000)
- Gate.io: BTC 숏 진입 (예상가: $41,800)

실제 체결:
- Aden.io: BTC 롱 진입 (실제가: $42,200) ← 슬리피지 발생
- Gate.io: BTC 숏 진입 (실제가: $41,600) ← 슬리피지 발생

결과: Aden.io 체결가($42,200) > Gate.io 체결가($41,600)
→ 차익거래 로직 오류 발생 가능
```

#### 🛡️ 오류 방지 방법

1. **거래량 기준을 충분히 높게 설정** (권장: 100만 USDT 이상)
2. **가격차이율 임계치를 충분히 높게 설정** (권장: 0.8% 이상)
3. **거래 전 수동으로 시장 상황 확인**
4. **소액으로 테스트 후 점진적 확대**

**거래량 기준 설정:**

- **보수적 거래**: `MIN_24_AMOUNT = 1000000` (100만 USDT)
- **적극적 거래**: `MIN_24_AMOUNT = 500000` (50만 USDT)
- **테스트용**: `MIN_24_AMOUNT = 300000` (30만 USDT)

### 📊 실행 예시

#### 🟢 정상적인 거래 예시 (거래량 높은 코인)

```
새로운 최고 가격차이율 발견!
시간: 2024-01-15 14:30:25
코인: BTC
가격차이율: 0.45%
Gate.io 가격: 42,150.50
Orderly 가격: 42,332.75
Gate.io 24시간 거래금액: 2,500,000 USDT
Orderly 24시간 거래금액: 1,800,000 USDT

[자동매매] Gate.io 가격이 더 높으므로 Orderly에서 시장가 매수 시도!
✅ 병렬 주문 성공!
Orderly 주문ID: 123456789
Gate.io 주문ID: 987654321

💰 BTC 차익거래 진입 완료! ===
📈 진입 시점 정보:
  - Orderly 진입가: $42,332.75
  - Gate.io 진입가: $42,150.50
  - 거래 수량: 0.001234
  - 거래 방향: Orderly 매수 + Gate.io 매도
  - 진입 시 가격차이율: 0.45%
  - 예상 수익률: 0.45%
```

#### ⚠️ 문제가 있는 거래 예시 (거래량 낮은 코인)

```
새로운 최고 가격차이율 발견!
시간: 2024-01-15 14:30:25
코인: XYZ
가격차이율: 0.60%
Gate.io 가격: 0.1250
Orderly 가격: 0.1258
Gate.io 24시간 거래금액: 150,000 USDT  ← 거래량 낮음
Orderly 24시간 거래금액: 120,000 USDT  ← 거래량 낮음

[자동매매] Gate.io 가격이 더 높으므로 Orderly에서 시장가 매수 시도!
✅ 병렬 주문 성공!
Orderly 주문ID: 123456789
Gate.io 주문ID: 987654321

💰 XYZ 차익거래 진입 완료! ===
📈 진입 시점 정보:
  - Orderly 진입가: $0.1265  ← 슬리피지 발생 (0.1258 → 0.1265)
  - Gate.io 진입가: $0.1242  ← 슬리피지 발생 (0.1250 → 0.1242)
  - 거래 수량: 100.000000
  - 거래 방향: Orderly 매수 + Gate.io 매도
  - 진입 시 가격차이율: 0.60%
  - 실제 체결 수익률: 0.18%  ← 슬리피지로 인한 수익률 감소
```

#### 📱 텔레그램 알림 예시

```
🟢 포지션 진입

📊 심볼: PERP_BTC_USDC
💰 수량: 0.001234
⏰ 시간: 2024-01-15 14:30:25

📊 진입가격:
  - Orderly: $42,332.75 (숏)
  - Gate.io: $42,150.50 (롱)
📊 가격차이율: 0.45%
```

---

## 📱 텔레그램 알림

### 알림 종류

1. **포지션 진입 알림**

   - 거래 심볼 및 방향
   - 진입 가격 (Orderly/Gate.io)
   - 가격차이율
   - 거래 수량

2. **포지션 종료 알림**
   - 종료 가격 정보
   - 최종 수익/손실
   - 현재 잔고 정보
   - 거래 방향

### 텔레그램 설정 방법

1. [@BotFather](https://t.me/botfather)에서 봇 생성
2. 봇 토큰을 `.env`에 추가
3. 봇과 대화 시작
4. 채팅 ID 확인 후 `.env`에 추가

---

## 📁 프로젝트 구조

```
aden/
├── action/                 # 자동매매 로직
│   ├── marketMonitor.ts   # 시장 모니터링
│   ├── positionManager.ts # 포지션 관리
│   ├── priceMonitor.ts    # 가격 모니터링
│   └── orderbookAnalyzer.ts # Orderbook 분석
├── services/              # 서비스 레이어
│   ├── apiClient.ts       # API 클라이언트
│   ├── dataProcessingService.ts # 데이터 처리
│   └── telegramService.ts # 텔레그램 알림
├── aden/                  # Orderly API
├── gateio/                # Gate.io API
├── config/                # 환경 설정
├── utils/                 # 유틸리티
└── types/                 # 타입 정의
```

---

## 🔒 보안 주의사항

1. **API 키 보안**

   - API 키를 절대 공개하지 마세요
   - `.env` 파일을 `.gitignore`에 추가하세요
   - 정기적으로 API 키를 갱신하세요

2. **거래 보안**

   - 처음에는 소액으로 테스트하세요
   - 손실 한도를 설정하세요
   - 정기적으로 수익률을 확인하세요

3. **시스템 보안**
   - 안전한 네트워크에서만 실행하세요
   - 정기적으로 로그를 확인하세요

---

## 📞 지원 및 문의

- **버그 리포트**: GitHub Issues 사용
- **기능 요청**: GitHub Issues 사용
- **보안 문제**: rkdwoals159@naver.com으로 이메일

---

## 📄 라이선스

이 프로젝트는 [MIT 라이선스](LICENSE) 하에 배포됩니다.

**MIT 라이선스의 주요 특징:**

- ✅ **자유로운 사용**: 개인 및 상업적 사용 가능
- ✅ **수정 및 배포**: 코드 수정 및 재배포 가능
- ✅ **상업적 이용**: 상업적 목적으로 사용 가능
- ⚠️ **면책 조항**: 개발자는 어떠한 책임도 지지 않음
- 📋 **저작권 표시**: 원본 저작권 표시 필요

**전체 라이선스 내용은 [LICENSE](LICENSE) 파일을 참조하세요.**

---

## ⚠️ 최종 경고

**이 프로그램은 실제 돈으로 거래됩니다. 사용 전 충분한 이해와 테스트가 필요합니다. 프로그램 사용으로 인한 손실에 대해 개발자는 책임지지 않습니다.**
